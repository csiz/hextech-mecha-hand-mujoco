<mujoco model="hexrobotics_mechahand_right">
  <compiler angle="radian" meshdir="assets" autolimits="true" eulerseq="xyz"/>
  
  <!-- Simulation options.

  Use the default timestep to have the simulation run at 500Hz.
    
  Recommended to increase impratio in order to grab objects better:
    > Settings larger than 1 cause friction forces to be “harder” than normal forces, having 
    > the general effect of preventing slip, without increasing the actual friction coefficient. 
  
  -->
  <option timestep="0.002" impratio="2"/>

  <default>
    <!-- The mesh files are saved in millimiteres. -->
    <default class="millimeter_units">
      <mesh scale="0.001 0.001 0.001"/>
    </default>

    <!-- Settings for range limited hinge joints with constraints tuned for 0.5Nm torque levels and about half a circle of range.
      Use a large damping coefficient to prevent oscillations.
      Use a large solimp to prevent the joint from overshooting the target position.
        Expecting format `dmin, dmax, width, midpoint, power`.
        Need large dmin and dmax to counter the actuator torque, use values up to 5Nm.
        Let the width be 0.05 radians, the default is a bit too sharp causes a lot of bouncing.
        Set the midpoint to 0.1 of width.
        Set the power to 4 to have the impedance increase quickly after the midpoint.
      Use the default solref, but set it explicitly to be aware of solver config.
        Expecting format `timeconst, dampratio`.
        Keep damping ratio at 1 for critical damping.
        Keep timeconst at 0.02s which is 10 times higher than the default timestep.
    -->
    <default class="limited_joint">
      <joint damping="0.1" solreflimit="0.02 1" solimplimit="0.8 5 0.05 0.1 4" limited="true"/>
    </default>
  </default>

  <!-- Link the 3D model files. -->
  <asset>
    <mesh class="millimeter_units" file="gimbal_structure.stl"/>
    <mesh class="millimeter_units" file="knuckle_gimbal.stl"/>
    <mesh class="millimeter_units" file="middle_segment.stl"/>
    <mesh class="millimeter_units" file="motor_box.stl"/>
    <mesh class="millimeter_units" file="mount_peg.stl"/>
    <mesh class="millimeter_units" file="palm.stl"/>
    <mesh class="millimeter_units" file="pinkie_pivot.stl"/>
    <mesh class="millimeter_units" file="proximal.stl"/>
    <mesh class="millimeter_units" file="squash_proximal.stl"/>
    <mesh class="millimeter_units" file="thumb_pivot.stl"/>
    <mesh class="millimeter_units" file="tip_spring_rod.stl"/>
    <mesh class="millimeter_units" file="tip.stl"/>
  </asset>

  <!-- Start of model spec. -->
  <worldbody>
    <!-- The mounting peg next to the elbow joint is the ground reference for the hand. -->
    <body name="mount_peg" pos="0 0 0">
      <geom type="mesh" mesh="mount_peg"/>

      <!-- The wrist is a ball joint made of 3 hinge joints. -->

      <!-- The box of tendon actuators rotates with the palm to avoid twisting the tendons. -->
      <body name="motor_box" pos="0 0 0">
        <inertial mass="0.9" pos="0 0.120 0.010" euler="0 0 1.5708" diaginertia="0.00075 0.00219 0.0024"/>
        <geom type="mesh" mesh="motor_box"/>
        <joint name="wrist_roll" class="limited_joint" axis="0 1 0" range="-1.0472 1.0472"/><!-- -60degrees 60degrees -->

        <!-- The second hinge joint drives the pitch of the palm. -->
        <body name="gimbal_structure" pos="0 0 0">
          <geom type="mesh" mesh="gimbal_structure" mass="0.020"/>
          <joint name="wrist_pitch" class="limited_joint" axis="1 0 0" range="-0.436332 0.959931"/><!-- -25degrees 55degrees -->

          <!-- The third hinge joint drives the yaw of the palm. -->  
          <body name="palm" pos="0 -0.005 0">
            <geom type="mesh" mesh="palm" mass="0.060"/>
            <joint name="wrist_yaw" class="limited_joint" axis="0 0 1" pos="0 0.005 0" range="-0.349066 0.349066"/><!-- -20degrees 20degrees -->

            <!-- The thumb pivot is an extra joint to allow the thumb to be opposable. The joint is on axis at 15 degree angle to the center line (the middle finger line). -->
            <body name="thumb_pivot" pos="0 0 0">
              <geom type="mesh" mesh="thumb_pivot" mass="0.010"/>
              <joint name="thumb_abduct" class="limited_joint" axis="-0.25882 0.96593 0" range="0 1.5708"/><!-- 0degrees 90degrees -->
            
              <!-- The thumb starts at 55mm from the palm origin and an angle of 45 degrees to the center line, followed by twisting 30 degrees around the finger axis. -->
              <body name="thumb_knuckle" pos="0.03889 -0.03889 0" euler="-0.3875967 0.3613671 0.857072 "> 
                <!-- The euler params are the result of applying 2 rotations, also specified by XYZ euler: 0 0 45degeers; 0 30degrees 0. -->
                <geom type="mesh" mesh="knuckle_gimbal" mass="0.005"/>
                <joint name="thumb_yaw" class="limited_joint" axis="0 0 1" range="-0.523599 0.523599"/><!-- 30degrees 30degrees -->

                <!-- The thumb uses the shorter proximal segment. The axis of the pitch joint is 15mm offset from the yaw axis, due to sensor space constraints. --> 
                <body name="thumb_proximal" pos="0 0 0">
                  <geom type="mesh" mesh="squash_proximal" mass="0.025"/>
                  <joint name="thumb_pitch" class="limited_joint" axis="1 0 0" pos="0 -0.015 0" range="0 1.5708"/><!-- 0degrees 90degrees -->

                  <!-- The shorter middle segment means the middle segment needs to be offset by 5mm. The joint is at 45mm from the finger yaw axis. -->
                  <body name="thumb_middle" pos="0 0.005 0">
                    <geom type="mesh" mesh="middle_segment" mass="0.013"/>
                    <joint name="thumb_curl" class="limited_joint" axis="1 0 0" pos="0 -0.045 0" range="0 1.5708"/><!-- 0degrees 90degrees -->

                    <!-- The tip axis joint is 75mm from the yaw axis for the stubbier finger. -->
                    <body name="thumb_tip" pos="0 0 0">
                      <geom type="mesh" mesh="tip" mass="0.015"/>
                      <joint name="thumb_tip" class="limited_joint" axis="1 0 0" pos="0 -0.075 0" range="0 1.5708"/><!-- 0degrees 90degrees -->
                    </body>
                  </body>
                </body>
              </body>
            
            </body>

            <!-- The index starts at 90mm from the palm origin and an angle of 15 degrees to the center line. -->
            <body name="index_knuckle" pos="0.02329 -0.08693 0" euler="0 0 0.261799">
              <geom type="mesh" mesh="knuckle_gimbal" mass="0.005"/>
              <joint name="index_yaw" class="limited_joint" axis="0 0 1" range="-0.523599 0.523599"/><!-- 30degrees 30degrees -->

              <!-- The axis of the pitch joint is 15mm offset from the yaw axis, due to sensor space constraints. --> 
              <body name="index_proximal" pos="0 0 0">
                <geom type="mesh" mesh="proximal" mass="0.027"/>
                <joint name="index_pitch" class="limited_joint" axis="1 0 0" pos="0 -0.015 0" range="0 1.5708"/><!-- 0degrees 90degrees -->

                <!-- The joint is at 50mm from the finger yaw axis. -->
                <body name="index_middle" pos="0 0 0">
                  <geom type="mesh" mesh="middle_segment" mass="0.013"/>
                  <joint name="index_curl" class="limited_joint" axis="1 0 0" pos="0 -0.050 0" range="0 1.5708"/><!-- 0degrees 90degrees -->

                  <!-- The tip axis joint is 80mm from the yaw axis for the finger. -->
                  <body name="index_tip" pos="0 0 0">
                    <geom type="mesh" mesh="tip" mass="0.015"/>
                    <joint name="index_tip" class="limited_joint" axis="1 0 0" pos="0 -0.075 0" range="0 1.5708"/><!-- 0degrees 90degrees -->
                  </body>
                </body>
              </body>
            </body>

            <!-- The middle starts at 90mm from the palm origin and is aligned with the center line. -->
            <body name="middle_knuckle" pos="0 -0.090 0" euler="0 0 0">
              <geom type="mesh" mesh="knuckle_gimbal" mass="0.005"/>
              <joint name="middle_yaw" class="limited_joint" axis="0 0 1" range="-0.523599 0.523599"/><!-- 30degrees 30degrees -->

              <!-- The axis of the pitch joint is 15mm offset from the yaw axis, due to sensor space constraints. --> 
              <body name="middle_proximal" pos="0 0 0">
                <geom type="mesh" mesh="proximal" mass="0.027"/>
                <joint name="middle_pitch" class="limited_joint" axis="1 0 0" pos="0 -0.015 0" range="0 1.5708"/><!-- 0degrees 90degrees -->

                <!-- The joint is at 50mm from the finger yaw axis. -->
                <body name="middle_middle" pos="0 0 0">
                  <geom type="mesh" mesh="middle_segment" mass="0.013"/>
                  <joint name="middle_curl" class="limited_joint" axis="1 0 0" pos="0 -0.050 0" range="0 1.5708"/><!-- 0degrees 90degrees -->

                  <!-- The tip axis joint is 80mm from the yaw axis for the finger. -->
                  <body name="middle_tip" pos="0 0 0">
                    <geom type="mesh" mesh="tip" mass="0.015"/>
                    <joint name="middle_tip" class="limited_joint" axis="1 0 0" pos="0 -0.075 0" range="0 1.5708"/><!-- 0degrees 90degrees -->
                  </body>
                </body>
              </body>
            </body>

            <!-- The ring finger starts at 90mm from the palm origin and an angle of 15 degrees to the center line. -->
            <body name="ring_knuckle" pos="-0.02329 -0.08693 0" euler="0 0 -0.261799">
              <geom type="mesh" mesh="knuckle_gimbal" mass="0.005"/>
              <joint name="ring_yaw" class="limited_joint" axis="0 0 1" range="-0.523599 0.523599"/><!-- 30degrees 30degrees -->

              <!-- The axis of the pitch joint is 15mm offset from the yaw axis, due to sensor space constraints. --> 
              <body name="ring_proximal" pos="0 0 0">
                <geom type="mesh" mesh="proximal" mass="0.027"/>
                <joint name="ring_pitch" class="limited_joint" axis="1 0 0" pos="0 -0.015 0" range="0 1.5708"/><!-- 0degrees 90degrees -->

                <!-- The joint is at 50mm from the finger yaw axis. -->
                <body name="ring_middle" pos="0 0 0">
                  <geom type="mesh" mesh="middle_segment" mass="0.013"/>
                  <joint name="ring_curl" class="limited_joint" axis="1 0 0" pos="0 -0.050 0" range="0 1.5708"/><!-- 0degrees 90degrees -->

                  <!-- The tip axis joint is 80mm from the yaw axis for the finger. -->
                  <body name="ring_tip" pos="0 0 0">
                    <geom type="mesh" mesh="tip" mass="0.015"/>
                    <joint name="ring_tip" class="limited_joint" axis="1 0 0" pos="0 -0.075 0" range="0 1.5708"/><!-- 0degrees 90degrees -->
                  </body>
                </body>
              </body>
            </body>

            <!-- The pinkie pivot functions similar to the thumb pivot and makes the pinkie opposable. It's simmetric with the thumb pivot at 15 degrees angle to the center line. -->
            <body name="pinkie_pivot" pos="0 0 0">
              <geom type="mesh" mesh="pinkie_pivot" mass="0.010"/>
              <joint name="pinkie_abduct" class="limited_joint" axis="-0.25882 -0.96593 0" range="0 1.0472"/><!-- 0degrees 60degrees -->

              <!-- The pinkie starts at 80mm from the palm origin and an angle of 30 degrees to the center line. -->
              <body name="pinkie_knuckle" pos="-0.04 -0.06928 0" euler="0 0 -0.523599">
                <geom type="mesh" mesh="knuckle_gimbal" mass="0.005"/>
                <joint name="pinkie_yaw" class="limited_joint" axis="0 0 1" range="-0.523599 0.523599"/><!-- 30degrees 30degrees -->

                <!-- The pinkie uses the shorter proximal segment. The axis of the pitch joint is 15mm offset from the yaw axis, due to sensor space constraints. --> 
                <body name="pinkie_proximal" pos="0 0 0">
                  <geom type="mesh" mesh="squash_proximal" mass="0.025"/>
                  <joint name="pinkie_pitch" class="limited_joint" axis="1 0 0" pos="0 -0.015 0" range="0 1.5708"/><!-- 0degrees 90degrees -->

                  <!-- The shorter middle segment means the middle segment needs to be offset by 5mm. The joint is at 45mm from the finger yaw axis. -->
                  <body name="pinkie_middle" pos="0 0.005 0">
                    <geom type="mesh" mesh="middle_segment" mass="0.013"/>
                    <joint name="pinkie_curl" class="limited_joint" axis="1 0 0" pos="0 -0.045 0" range="0 1.5708"/><!-- 0degrees 90degrees -->

                    <!-- The tip axis joint is 75mm from the yaw axis for the stubbier pinkie finger. -->
                    <body name="pinkie_tip" pos="0 0 0">
                      <geom type="mesh" mesh="tip" mass="0.015"/>
                      <joint name="pinkie_tip" class="limited_joint" axis="1 0 0" pos="0 -0.075 0" range="0 1.5708"/><!-- 0degrees 90degrees -->
                    </body>
                  </body>
                </body>
              </body>
            </body>

            
          </body>
        </body>
      </body>
    </body>
    
  </worldbody>

  <!-- Exclude additional closeby bodies. We're using the convex hull for collisions so many pieces intersect in the normal pose. -->
  <contact>
    <exclude body1="mount_peg" body2="motor_box"/>
    <exclude body1="motor_box" body2="gimbal_structure"/>
    <exclude body1="motor_box" body2="palm"/>
    <exclude body1="gimbal_structure" body2="palm"/>
    <exclude body1="palm" body2="thumb_pivot"/>
    <exclude body1="palm" body2="pinkie_pivot"/>
    <exclude body1="palm" body2="thumb_knuckle"/>
    <exclude body1="palm" body2="thumb_proximal"/>
    <exclude body1="palm" body2="thumb_middle"/>
    <exclude body1="palm" body2="index_proximal"/>
    <exclude body1="palm" body2="middle_proximal"/>
    <exclude body1="palm" body2="ring_proximal"/> 
    <exclude body1="palm" body2="pinkie_knuckle"/>
    <exclude body1="palm" body2="pinkie_proximal"/>
    <exclude body1="palm" body2="pinkie_middle"/>
    <exclude body1="thumb_pivot" body2="pinkie_pivot"/>
    <exclude body1="thumb_pivot" body2="thumb_knuckle"/>
    <exclude body1="thumb_pivot" body2="thumb_proximal"/>
    <exclude body1="thumb_knuckle" body2="thumb_proximal"/>
    <exclude body1="pinkie_pivot" body2="pinkie_knuckle"/>
    <exclude body1="pinkie_pivot" body2="pinkie_proximal"/>
    <exclude body1="pinkie_knuckle" body2="pinkie_proximal"/>
  </contact>

  <tendon>
  </tendon>

  <!-- Name, range and force settings for the actuators. -->
  <actuator>
    <position name="thumb_tip" joint="thumb_tip" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="thumb_curl" joint="thumb_curl" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="thumb_pitch" joint="thumb_pitch" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="thumb_yaw" joint="thumb_yaw" kp="0.4" ctrlrange="-0.698132 0.698132" forcerange="-0.6 0.6"/><!-- -40degrees 40degrees -->
    <position name="index_tip" joint="index_tip" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="index_curl" joint="index_curl" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="index_pitch" joint="index_pitch" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="index_yaw" joint="index_yaw" kp="0.4" ctrlrange="-0.698132 0.698132" forcerange="-0.6 0.6"/><!-- -40degrees 40degrees -->
    <position name="middle_tip" joint="middle_tip" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="middle_curl" joint="middle_curl" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="middle_pitch" joint="middle_pitch" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="middle_yaw" joint="middle_yaw" kp="0.4" ctrlrange="-0.698132 0.698132" forcerange="-0.6 0.6"/><!-- -40degrees 40degrees -->
    <position name="ring_tip" joint="ring_tip" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="ring_curl" joint="ring_curl" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="ring_pitch" joint="ring_pitch" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="ring_yaw" joint="ring_yaw" kp="0.4" ctrlrange="-0.698132 0.698132" forcerange="-0.6 0.6"/><!-- -40degrees 40degrees -->
    <position name="pinkie_tip" joint="pinkie_tip" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="pinkie_curl" joint="pinkie_curl" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="pinkie_pitch" joint="pinkie_pitch" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="pinkie_yaw" joint="pinkie_yaw" kp="0.4" ctrlrange="-0.698132 0.698132" forcerange="-0.6 0.6"/><!-- -40degrees 40degrees -->
    <position name="pinkie_abduct" joint="pinkie_abduct" kp="0.4" ctrlrange="-0.261799 1.309" forcerange="-0.4 0.4"/><!-- -15degrees 75degrees -->
    <position name="thumb_abduct" joint="thumb_abduct" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="wrist_yaw" joint="wrist_yaw" kp="1.5" ctrlrange="-0.523599 0.523599" forcerange="-0.8 0.8"/><!-- -30degrees 30degrees -->
    <position name="wrist_pitch" joint="wrist_pitch" kp="1.5" ctrlrange="-0.698132 1.22173" forcerange="-0.8 0.8"/><!-- -40degrees 70degrees -->
    <position name="wrist_roll" joint="wrist_roll" kp="2.0" ctrlrange="-1.309 1.309" forcerange="-1.0 1.0"/><!-- -75degrees 75degrees -->
  </actuator>
</mujoco>