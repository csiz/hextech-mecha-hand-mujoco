<mujoco model="hexrobotics_mechahand_right">
  <compiler angle="radian" meshdir="assets" autolimits="true" eulerseq="xyz"/>
  
  <!-- Simulation options.

  Use the default timestep to have the simulation run at 500Hz.
    
  Recommended to increase impratio in order to grab objects better:
    > Settings larger than 1 cause friction forces to be “harder” than normal forces, having 
    > the general effect of preventing slip, without increasing the actual friction coefficient. 
  
  -->
  <option timestep="0.002" impratio="2"/>

  <default>
    <!-- The mesh files are saved in millimiteres. -->
    <default class="millimeter_units">
      <mesh scale="0.001 0.001 0.001"/>
    </default>

    <!-- Settings for range limited hinge joints with constraints tuned for 0.5Nm torque levels.
      Use a large damping coefficient to prevent oscillations.
      Use a large solimp to prevent the joint from overshooting the target position.
        Expecting format `dmin, dmax, width, midpoint, power`.
        Need large dmin and dmax to counter the actuator torque, use values up to 5Nm.
        Let the width be 0.05 radians, the default is a bit too sharp causes a lot of bouncing.
        Set the midpoint to 0.1 of width.
        Set the power to 4 to have the impedance increase quickly after the midpoint.
      Use the default solref, but set it explicitly to be aware of solver config.
        Expecting format `timeconst, dampratio`.
        Keep damping ratio at 1 for critical damping.
        Keep timeconst at 0.02s which is 10 times higher than the default timestep.
    -->
    <default class="limited_joint">
      <joint damping="0.1" solreflimit="0.02 1" solimplimit="0.8 5 0.05 0.1 4" limited="true"/>
    </default>
  </default>

  <asset>
    <mesh class="millimeter_units" file="gimbal_structure.stl"/>
    <mesh class="millimeter_units" file="knuckle_gimbal.stl"/>
    <mesh class="millimeter_units" file="middle_segment.stl"/>
    <mesh class="millimeter_units" file="motor_box.stl"/>
    <mesh class="millimeter_units" file="mount_peg.stl"/>
    <mesh class="millimeter_units" file="palm.stl"/>
    <mesh class="millimeter_units" file="pinkie_pivot.stl"/>
    <mesh class="millimeter_units" file="proximal.stl"/>
    <mesh class="millimeter_units" file="squash_proximal.stl"/>
    <mesh class="millimeter_units" file="thumb_pivot.stl"/>
    <mesh class="millimeter_units" file="tip_spring_rod.stl"/>
    <mesh class="millimeter_units" file="tip.stl"/>
  </asset>

  <worldbody>
    <!-- The mounting peg next to the elbow joint is the ground reference for the hand. -->
    <body name="mount_peg" pos="0 0 0">
      <geom type="mesh" mesh="mount_peg"/>

      <!-- The wrist is a ball joint made of 3 hinge joints. -->

      <!-- The box of tendon actuators rotates with the palm to avoid twisting the tendons. -->
      <body name="motor_box" pos="0 0 0">
        <inertial mass="0.9" pos="0 0.120 0.010" euler="0 0 90" diaginertia="0.00075 0.00219 0.0024"/>
        <geom type="mesh" mesh="motor_box"/>
        <joint name="wrist_roll" class="limited_joint" axis="0 1 0" range="-1.0472 1.0472"/><!-- -60degrees 60degrees -->

        <!-- The second hinge joint drives the pitch of the palm. -->
        <body name="gimbal_structure" pos="0 0 0">
          <geom type="mesh" mesh="gimbal_structure" mass="0.020"/>
          <joint name="wrist_pitch" class="limited_joint" axis="1 0 0" range="-0.436332 0.959931"/><!-- -25degrees 55degrees -->

          <!-- The third hinge joint drives the yaw of the palm. -->  
          <body name="palm" pos="0 -0.005 0">
            <geom type="mesh" mesh="palm"/>
            <joint name="wrist_yaw" class="limited_joint" axis="0 0 1" pos="0 0.005 0" range="-0.349066 0.349066"/><!-- -20degrees 20degrees -->

            <body name="thumb_pivot" pos="0 0 0">
              <geom type="mesh" mesh="thumb_pivot"/>
              <joint name="thumb_abduct" class="limited_joint" axis="-0.25882 0.96593 0" range="0 1.5708"/><!-- 0degrees 90degrees -->
            </body>

            <body name="pinkie_pivot" pos="0 0 0">
              <geom type="mesh" mesh="pinkie_pivot"/>
              <joint name="pinkie_abduct" class="limited_joint" axis="-0.25882 -0.96593 0" range="0 1.0472"/><!-- 0degrees 60degrees -->
            </body>
          </body>
        </body>
      </body>
    </body>
    
  </worldbody>

  <contact>
    <exclude body1="mount_peg" body2="motor_box"/>
    <exclude body1="motor_box" body2="gimbal_structure"/>
    <exclude body1="motor_box" body2="palm"/>
    <exclude body1="gimbal_structure" body2="palm"/>
    <exclude body1="palm" body2="thumb_pivot"/>
    <exclude body1="palm" body2="pinkie_pivot"/>
    <exclude body1="thumb_pivot" body2="pinkie_pivot"/>
  </contact>

  <tendon>
  </tendon>

  <actuator>
<!--     <position name="thumb_tip" joint="thumb_tip"/>
    <position name="thumb_curl" joint="thumb_curl"/>
    <position name="thumb_pitch" joint="thumb_pitch"/>
    <position name="thumb_yaw" joint="thumb_yaw"/>
    <position name="index_tip" joint="index_tip"/>
    <position name="index_curl" joint="index_curl"/>
    <position name="index_pitch" joint="index_pitch"/>
    <position name="index_yaw" joint="index_yaw"/>
    <position name="middle_tip" joint="middle_tip"/>
    <position name="middle_curl" joint="middle_curl"/>
    <position name="middle_pitch" joint="middle_pitch"/>
    <position name="middle_yaw" joint="middle_yaw"/>
    <position name="ring_tip" joint="ring_tip"/>
    <position name="ring_curl" joint="ring_curl"/>
    <position name="ring_pitch" joint="ring_pitch"/>
    <position name="ring_yaw" joint="ring_yaw"/>
    <position name="pinkie_tip" joint="pinkie_tip"/>
    <position name="pinkie_curl" joint="pinkie_curl"/>
    <position name="pinkie_pitch" joint="pinkie_pitch"/>
    <position name="pinkie_yaw" joint="pinkie_yaw"/> -->
    <position name="pinkie_abduct" joint="pinkie_abduct" kp="0.4" ctrlrange="-0.261799 1.309" forcerange="-0.4 0.4"/><!-- -15degrees 75degrees -->
    <position name="thumb_abduct" joint="thumb_abduct" kp="0.4" ctrlrange="-0.261799 1.8326" forcerange="-0.6 0.6"/><!-- -15degrees 105degrees -->
    <position name="wrist_yaw" joint="wrist_yaw" kp="0.4" ctrlrange="-0.523599 0.523599" forcerange="-0.8 0.8"/><!-- -30degrees 30degrees -->
    <position name="wrist_pitch" joint="wrist_pitch" kp="0.4" ctrlrange="-0.698132 1.22173" forcerange="-0.8 0.8"/><!-- -40degrees 70degrees -->
    <position name="wrist_roll" joint="wrist_roll" kp="0.6" ctrlrange="-1.309 1.309" forcerange="-1.0 1.0"/><!-- -75degrees 75degrees -->
  </actuator>
</mujoco>